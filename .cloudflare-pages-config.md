# Cloudflare Pages Configuration

## Quick Setup Guide

### Build Configuration

When setting up your Cloudflare Pages project, use these exact settings:

- **Production branch**: `main` (or your default branch)
- **Framework preset**: `Vite`
- **Build command**: `pnpm build`
- **Build output directory**: `dist`
- **Root directory**: `/` (leave empty)

### Environment Variables

No environment variables are required for basic deployment.

### Build Settings Explained

1. **Framework preset: Vite**
   - Automatically configures Node.js version and build environment
   - Enables optimizations for Vite-based projects

2. **Build command: pnpm build**
   - Runs TypeScript compilation: `tsc`
   - Then runs Vite build for production
   - Generates optimized bundles in `dist` folder

3. **Build output directory: dist**
   - Contains all static assets ready for deployment
   - Includes `_headers` for security headers
   - Includes `_redirects` for client-side routing

### What Gets Deployed

The `dist` folder contains:
- `index.html` - Main HTML file
- `assets/` - All CSS, JS, and source maps
- `_headers` - HTTP headers configuration
- `_redirects` - URL rewriting rules for SPA routing
- `mastra.svg` - Favicon/logo

### Routing Configuration

The `_redirects` file handles client-side routing:
```
/*    /index.html   200
```

This ensures all routes are handled by the React application.

### Security Headers

The `_headers` file includes:
- X-Frame-Options: DENY
- X-Content-Type-Options: nosniff
- Referrer-Policy: strict-origin-when-cross-origin
- Cache-Control headers for optimal performance

### Build Optimization

The build is optimized with:
- Code splitting (7 chunks)
- Tree shaking
- Minification
- Gzip compression
- Source maps for debugging

### Troubleshooting

**Build fails:**
- Check that pnpm is being used (Cloudflare auto-detects from `pnpm-lock.yaml`)
- Verify Node.js version is 18+
- Check build logs for TypeScript errors

**404 errors on routes:**
- Verify `_redirects` file is in `dist` folder
- Check that build output directory is set to `dist`

**Assets not loading:**
- Verify `copyPublicDir` is enabled in `vite.config.ts`
- Check that build completed successfully

### Deployment URL

After deployment, your site will be available at:
- Production: `https://mastra-agent-builder.pages.dev`
- Or your custom domain if configured

### Custom Domain

To add a custom domain:
1. Go to your Pages project
2. Navigate to **Custom domains**
3. Click **Set up a custom domain**
4. Follow the DNS configuration steps

---

**Need help?** See [DEPLOYMENT.md](./DEPLOYMENT.md) for detailed instructions.
